initStyles=function(){addCSS(defaultStyles)},$(initStyles),pending=[],$.fn.sparkline=function(l,e){return this.each(function(){var t,i,a=new $.fn.sparkline.options(this,e),g=$(this);if(t=function(){var t,i,e,n,s,r,h;t="html"===l||void 0===l?(null==(h=this.getAttribute(a.get("tagValuesAttribute")))&&(h=g.html()),h.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):l,i="auto"===a.get("width")?t.length*a.get("defaultPixelsPerValue"):a.get("width"),"auto"===a.get("height")?a.get("composite")&&$.data(this,"_jqs_vcanvas")||((n=document.createElement("span")).innerHTML="a",g.html(n),e=$(n).innerHeight()||$(n).height(),$(n).remove(),n=null):e=a.get("height"),a.get("disableInteraction")?s=!1:(s=$.data(this,"_jqs_mhandler"))?a.get("composite")||s.reset():(s=new MouseHandler(this,a),$.data(this,"_jqs_mhandler",s)),!a.get("composite")||$.data(this,"_jqs_vcanvas")?((r=new($.fn.sparkline[a.get("type")])(this,t,a,i,e)).render(),s&&s.registerSparkline(r)):$.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),$.data(this,"_jqs_errnotify",!0))},$(this).html()&&!a.get("disableHiddenCheck")&&$(this).is(":hidden")||!$(this).parents("body").length){if(!a.get("composite")&&$.data(this,"_jqs_pending"))for(i=pending.length;i;i--)pending[i-1][0]==this&&pending.splice(i-1,1);pending.push([this,t]),$.data(this,"_jqs_pending",!0)}else t.call(this)})},$.fn.sparkline.defaults=getDefaults(),$.sparkline_display_visible=function(){var t,i,e,n=[];for(i=0,e=pending.length;i<e;i++)t=pending[i][0],$(t).is(":visible")&&!$(t).parents().is(":hidden")?(pending[i][1].call(t),$.data(pending[i][0],"_jqs_pending",!1),n.push(i)):$(t).closest("html").length||$.data(t,"_jqs_pending")||($.data(pending[i][0],"_jqs_pending",!1),n.push(i));for(i=n.length;i;i--)pending.splice(n[i-1],1)},$.fn.sparkline.options=createClass({init:function(t,i){var e,n,s,r;this.userOptions=i=i||{},this.tag=t,this.tagValCache={},s=(n=$.fn.sparkline.defaults).common,this.tagOptionsPrefix=i.enableTagOptions&&(i.tagOptionsPrefix||s.tagOptionsPrefix),e=(r=this.getTagSetting("type"))===UNSET_OPTION?n[i.type||s.type]:n[r],this.mergedOptions=$.extend({},s,e,i)},getTagSetting:function(t){var i,e,n,s,r=this.tagOptionsPrefix;if(!1===r||void 0===r)return UNSET_OPTION;if(this.tagValCache.hasOwnProperty(t))i=this.tagValCache.key;else{if(null==(i=this.tag.getAttribute(r+t)))i=UNSET_OPTION;else if("["===i.substr(0,1))for(e=(i=i.substr(1,i.length-2).split(",")).length;e--;)i[e]=normalizeValue(i[e].replace(/(^\s*)|(\s*$)/g,""));else if("{"===i.substr(0,1))for(n=i.substr(1,i.length-2).split(","),i={},e=n.length;e--;)i[(s=n[e].split(":",2))[0].replace(/(^\s*)|(\s*$)/g,"")]=normalizeValue(s[1].replace(/(^\s*)|(\s*$)/g,""));else i=normalizeValue(i);this.tagValCache.key=i}return i},get:function(t,i){var e,n=this.getTagSetting(t);return n!==UNSET_OPTION?n:void 0===(e=this.mergedOptions[t])?i:e}}),$.fn.sparkline._base=createClass({disabled:!1,init:function(t,i,e,n,s){this.el=t,this.$el=$(t),this.values=i,this.options=e,this.width=n,this.height=s,this.currentRegion=void 0},initTarget:function(){var t=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),t))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return!this.disabled||(this.el.innerHTML="",!1)},getRegion:function(t,i){},setRegionHighlight:function(t,i,e){var n,s=this.currentRegion,r=!this.options.get("disableHighlight");return i>this.canvasWidth||e>this.canvasHeight||i<0||e<0?null:s!==(n=this.getRegion(t,i,e))&&(void 0!==s&&r&&this.removeHighlight(),void 0!==(this.currentRegion=n)&&r&&this.renderHighlight(),!0)},clearRegionHighlight:function(){return void 0!==this.currentRegion&&(this.removeHighlight(),!(this.currentRegion=void 0))},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(t){},getCurrentRegionTooltip:function(){var t,i,e,n,s,r,h,a,g,l,o,p,d,u,f=this.options,c="",v=[];if(void 0===this.currentRegion)return"";if(t=this.getCurrentRegionFields(),o=f.get("tooltipFormatter"))return o(this,f,t);if(f.get("tooltipChartTitle")&&(c+='<div class="jqs jqstitle">'+f.get("tooltipChartTitle")+"</div>\n"),!(i=this.options.get("tooltipFormat")))return"";if($.isArray(i)||(i=[i]),$.isArray(t)||(t=[t]),h=this.options.get("tooltipFormatFieldlist"),a=this.options.get("tooltipFormatFieldlistKey"),h&&a){for(g=[],r=t.length;r--;)l=t[r][a],-1!=(u=$.inArray(l,h))&&(g[u]=t[r]);t=g}for(e=i.length,d=t.length,r=0;r<e;r++)for("string"==typeof(p=i[r])&&(p=new SPFormat(p)),n=p.fclass||"jqsfield",u=0;u<d;u++)t[u].isNull&&f.get("tooltipSkipNull")||($.extend(t[u],{prefix:f.get("tooltipPrefix"),suffix:f.get("tooltipSuffix")}),s=p.render(t[u],f.get("tooltipValueLookups"),f),v.push('<div class="'+n+'">'+s+"</div>"));return v.length?c+v.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(t,i){var e,n,s,r,h=i.get("highlightColor"),a=i.get("highlightLighten");if(h)return h;if(a&&(e=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(t))){for(s=[],n=4===t.length?16:1,r=0;r<3;r++)s[r]=clipval(Math.round(parseInt(e[r+1],16)*n*a),0,255);return"rgb("+s.join(",")+")"}return t}}),barHighlightMixin={changeHighlight:function(t){var i,e=this.currentRegion,n=this.target,s=this.regionShapes[e];s&&(i=this.renderRegion(e,t),$.isArray(i)||$.isArray(s)?(n.replaceWithShapes(s,i),this.regionShapes[e]=$.map(i,function(t){return t.id})):(n.replaceWithShape(s,i),this.regionShapes[e]=i.id))},render:function(){var t,i,e,n,s=this.values,r=this.target,h=this.regionShapes;if(this.cls._super.render.call(this)){for(e=s.length;e--;)if(t=this.renderRegion(e))if($.isArray(t)){for(i=[],n=t.length;n--;)t[n].append(),i.push(t[n].id);h[e]=i}else t.append(),h[e]=t.id;else h[e]=null;r.render()}}};