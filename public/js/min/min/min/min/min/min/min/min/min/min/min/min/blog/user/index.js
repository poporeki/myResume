function getObjectURL(e){var t=null;return null!=window.createObjectURL?t=window.createObjectURL(e):null!=window.URL?t=window.URL.createObjectURL(e):null!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}$(function(){var a,e,t,n,i,s,o,l,r,d,c,u,w={name:/^[\D]{1}([\u4e00-\u9fa5\-\w]){3,11}$/,pwd:/^\S{6,20}$/,tel:/^1[3-9]\d{9}$/};t=(e=$(".tab")).find(".tab-head"),n=e.find(".tab-body"),i=t.find(".tab-head-item"),s=n.find(".tab-body-item"),i.eq(0).addClass("active"),s.eq(0).addClass("show"),i.on("click",function(){if(i.length!=s.length)return console.log("!=");var e=$(this),t=e.index();e.addClass("active").siblings().removeClass("active"),s.eq(t).addClass("show").siblings().removeClass("show")}),o=$("#img_avatar"),l=$(".select-img"),r=$(".submit-btn"),d=$(".modal-box"),c=d.find(".close-btn"),(u=$(".top-box .head-box")).on("click",function(){if(d.hasClass("show"))return!1;d.addClass("show")}),c.on("click",function(){o.cropper("destroy"),o.attr("src",""),l.val(""),$(".modal-box").removeClass("show")}),l.on("change",function(){$(this);var e=getObjectURL(this.files[0]);e&&(o.cropper("destroy"),o.attr("src",e),o.cropper({aspectRatio:1,preview:".small-preview,.small-preview2"}),a=o.data("cropper"))}),r.on("click",function(){var t=$(this);if(0==t.find(".loading-ani").length){var e=a.getCroppedCanvas().toDataURL("image/jpeg");requestAjax({el:t,url:"/blog/user/uploadAvatar",data:{imgBase:e}},function(e){if(!e.status)return t.text("错误"),!1;c.trigger("click"),u.find("img").attr("src",e.data.src)})}}),$("#submit_pwd").on("click",function(){var e=$(this);if(0==e.find(".loading-ani").length){var t=$("#pwd").val(),a=$("#new_pwd").val();if(""==t||""==a)return alert("不能为空");requestAjax({el:e,url:"/blog/user/changeUserPassword",data:{password:t,new_password:a}},function(e){e.status?(alert("修改成功"),$("#pwd").val(""),$("#new_pwd").val("")):alert("修改失败")})}}),$(".btn-update-username").on("click",function(){var e=$(this).parent().parent();e.hasClass("show")?e.removeClass("show"):e.addClass("show")}),$(".input-text-username").on("keyup blur",function(){var e=$(this).val(),t=$(this).next();t.html(""),w.name.test(e)||t.html("格式错误")}),$(".update-info-btn").on("click",function(){var e=$("#text_username"),t=$("#text_telnumber"),a=$("#text_email");requestAjax({el:$(this),url:"/api/v1/user/updateAccountInfo",type:"post",data:{username:""!==e.val()?e.val():void 0,telnumber:""!==t.val()?t.val():void 0,email:""!==a.val()?a.val():void 0}},function(e){1===e.status?window.location.href=window.location.href:alert("修改失败")})})});