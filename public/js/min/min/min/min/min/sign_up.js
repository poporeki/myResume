$(function(){var d=/^[\D]{1}([\u4e00-\u9fa5\-\w]){3,11}$/,l=/^\S{6,20}$/,a=$(".captcha-img"),r=$(".form-list"),e=$(".su-box");a.on("click",function(){requestAjax({el:a,url:"verify/refreshCaptcha"},function(r){(r||r.data)&&a.attr("src",r.data)})}),r.on("keyup",function(r){$(this);var a=$(r.target),s=a.parent(),t=a.val(),e=parseInt(a.attr("data-status")),o=a.siblings(".tips-box");if(""==t)return e=0,a.attr("data-status",0),void o.removeClass("canuse error noerr show").addClass("show error").text("内容不能为空");if(e=1,a.attr("data-status",1),o.removeClass("canuse error noerr show").text(""),a.hasClass("username")&&((n=d.test(t))||o.removeClass("canuse error noerr show").addClass("show error").text("请输入正确的账号"),n&&e&&requestAjax({el:s,url:"/verify/checkUserName",data:{username:t}},function(r){r?o.removeClass("canuse error noerr show").addClass("show canuse").text("可以注册"):o.removeClass("canuse error noerr show").addClass("show error").text("已被占用")})),a.hasClass("password")){var n;if(!(n=l.test(t)))return o.removeClass("canuse error noerr show").addClass("show error").text("请输入合适的密码"),void a.attr("data-status",0);a.attr("data-status",1)}if(a.hasClass("check-password")){var u=$("#password"),i=a;if(u.val()!=i.val())return a.attr("data-status",0),void o.removeClass("canuse error noerr show").addClass("show error").text("密码不一致，请重新输入");a.attr("data-status",1)}a.hasClass("captcha")&&requestAjax({el:s,url:"/verify/checkCaptcha",data:{str:t}},function(r){r?(a.attr("data-status",1),o.removeClass("canuse error noerr show").addClass("show canuse").text("ok!")):(a.attr("data-status",0),o.removeClass("canuse error noerr show").addClass("show error").text("false"))})}),$(".su-submit-btn").on("click",function(){var r=$(this),a=e.find("input");a.trigger("keyup");var s=!0;if(a.each(function(){if(s){var r=$(this);return 0===parseInt(r.attr("data-status"))?s=!1:void 0}}),!s)return alert("有错误信息,请检查");var t=e.serializeArray();requestAjax({el:r,url:"/reg",data:t},function(r){if(!r.status)return alert(""!=r.msg?r.msg:"失敗");var a=e.find(".su-tips"),s=a.find("span small");a.addClass("show"),function r(a){if(a<=0)return document.referrer="",window.location.href="/login";setTimeout(function(){a--,s.text(a),r(a)},1e3)}(5)})})});